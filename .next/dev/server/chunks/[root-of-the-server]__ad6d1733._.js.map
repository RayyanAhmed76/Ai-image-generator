{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/my-flux-saas/app/api/fetch_result/route.ts"],"sourcesContent":["// app/api/fetch_result/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { pollingUrl } = await req.json();\r\n    if (!pollingUrl) return NextResponse.json({ error: \"Missing pollingUrl\" }, { status: 400 });\r\n\r\n    const apiKey = process.env.BFL_API_KEY;\r\n    if (!apiKey) return NextResponse.json({ error: \"Server misconfiguration\" }, { status: 500 });\r\n\r\n    const resp = await fetch(pollingUrl, { headers: { \"x-key\": apiKey, \"Content-Type\": \"application/json\" } });\r\n    if (resp.status === 204) return NextResponse.json({ ready: false }, { status: 200 });\r\n\r\n    const json = await resp.json().catch(() => null);\r\n    if (!json) return NextResponse.json({ error: \"Failed to parse polling response\" }, { status: 502 });\r\n\r\n    const imageUrl =\r\n      json?.result?.sample ||\r\n      json?.result?.outputs?.[0]?.url ||\r\n      json?.image_url ||\r\n      json?.data?.url ||\r\n      (typeof json?.output_base64 === \"string\" ? `data:image/png;base64,${json.output_base64}` : null);\r\n\r\n    if (imageUrl) return NextResponse.json({ imageUrl }, { status: 200 });\r\n\r\n    const status = (json?.status || json?.state || \"\").toString().toLowerCase();\r\n    if (status && (status.includes(\"ready\") || status.includes(\"succeeded\") || status.includes(\"completed\"))) {\r\n      return NextResponse.json({ ready: true, imageUrl: null, raw: json }, { status: 200 });\r\n    }\r\n\r\n    return NextResponse.json({ ready: false, raw: json }, { status: 200 });\r\n  } catch (err) {\r\n    console.error(\"Error in /api/fetch_result:\", err);\r\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,gCAAgC;;;;;AAChC;;AAGO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,UAAU,EAAE,GAAG,MAAM,IAAI,IAAI;QACrC,IAAI,CAAC,YAAY,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqB,GAAG;YAAE,QAAQ;QAAI;QAEzF,MAAM,SAAS,QAAQ,GAAG,CAAC,WAAW;QACtC,IAAI,CAAC,QAAQ,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;QAE1F,MAAM,OAAO,MAAM,MAAM,YAAY;YAAE,SAAS;gBAAE,SAAS;gBAAQ,gBAAgB;YAAmB;QAAE;QACxG,IAAI,KAAK,MAAM,KAAK,KAAK,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAM,GAAG;YAAE,QAAQ;QAAI;QAElF,MAAM,OAAO,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,IAAM;QAC3C,IAAI,CAAC,MAAM,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAmC,GAAG;YAAE,QAAQ;QAAI;QAEjG,MAAM,WACJ,MAAM,QAAQ,UACd,MAAM,QAAQ,SAAS,CAAC,EAAE,EAAE,OAC5B,MAAM,aACN,MAAM,MAAM,OACZ,CAAC,OAAO,MAAM,kBAAkB,WAAW,CAAC,sBAAsB,EAAE,KAAK,aAAa,EAAE,GAAG,IAAI;QAEjG,IAAI,UAAU,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE;QAAS,GAAG;YAAE,QAAQ;QAAI;QAEnE,MAAM,SAAS,CAAC,MAAM,UAAU,MAAM,SAAS,EAAE,EAAE,QAAQ,GAAG,WAAW;QACzE,IAAI,UAAU,CAAC,OAAO,QAAQ,CAAC,YAAY,OAAO,QAAQ,CAAC,gBAAgB,OAAO,QAAQ,CAAC,YAAY,GAAG;YACxG,OAAO,sKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;gBAAM,UAAU;gBAAM,KAAK;YAAK,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAO,KAAK;QAAK,GAAG;YAAE,QAAQ;QAAI;IACtE,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF","debugId":null}}]
}