{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/my-flux-saas/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient();\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n\n"],"names":[],"mappings":";;;;AAAA;;AAGA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/my-flux-saas/lib/auth.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\r\nimport { prisma } from \"./prisma\";\r\n\r\nexport async function getCurrentUser(req: NextRequest) {\r\n  const token = req.cookies.get(\"flux_auth\")?.value;\r\n  \r\n  if (!token) {\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    // Find token in database\r\n    const tokenRecord = await prisma.token.findUnique({\r\n      where: { token },\r\n      include: { user: true },\r\n    });\r\n\r\n    if (!tokenRecord) {\r\n      return null;\r\n    }\r\n\r\n    // Check if token is expired\r\n    if (new Date() > tokenRecord.expiresAt) {\r\n      // Delete expired token\r\n      await prisma.token.delete({ where: { id: tokenRecord.id } });\r\n      return null;\r\n    }\r\n\r\n    return tokenRecord.user;\r\n  } catch (error) {\r\n    console.error(\"Error getting current user:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function getUserUsageCount(userId: string): Promise<number> {\r\n  try {\r\n    const count = await prisma.usage.count({\r\n      where: { userId },\r\n    });\r\n    return count;\r\n  } catch (error) {\r\n    console.error(\"Error getting usage count:\", error);\r\n    return 0;\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;AACA;;AAEO,eAAe,eAAe,GAAgB;IACnD,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc;IAE5C,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,IAAI;QACF,yBAAyB;QACzB,MAAM,cAAc,MAAM,+IAAM,CAAC,KAAK,CAAC,UAAU,CAAC;YAChD,OAAO;gBAAE;YAAM;YACf,SAAS;gBAAE,MAAM;YAAK;QACxB;QAEA,IAAI,CAAC,aAAa;YAChB,OAAO;QACT;QAEA,4BAA4B;QAC5B,IAAI,IAAI,SAAS,YAAY,SAAS,EAAE;YACtC,uBAAuB;YACvB,MAAM,+IAAM,CAAC,KAAK,CAAC,MAAM,CAAC;gBAAE,OAAO;oBAAE,IAAI,YAAY,EAAE;gBAAC;YAAE;YAC1D,OAAO;QACT;QAEA,OAAO,YAAY,IAAI;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;IACT;AACF;AAEO,eAAe,kBAAkB,MAAc;IACpD,IAAI;QACF,MAAM,QAAQ,MAAM,+IAAM,CAAC,KAAK,CAAC,KAAK,CAAC;YACrC,OAAO;gBAAE;YAAO;QAClB;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/my-flux-saas/app/api/check-usage/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { getCurrentUser, getUserUsageCount } from \"../../../lib/auth\";\n\nconst FREE_TRIES_LIMIT = 2;\n\nexport async function GET(req: NextRequest) {\n  try {\n    const user = await getCurrentUser(req);\n    \n    if (!user) {\n      return NextResponse.json({ authenticated: false }, { status: 401 });\n    }\n\n    const usageCount = await getUserUsageCount(user.id);\n    const canUse = user.isSubscribed || usageCount < FREE_TRIES_LIMIT;\n\n    return NextResponse.json({\n      authenticated: true,\n      isSubscribed: user.isSubscribed,\n      usageCount,\n      canUse,\n      limitReached: !user.isSubscribed && usageCount >= FREE_TRIES_LIMIT,\n      username: user.username,\n      email: user.email,\n    });\n  } catch (error) {\n    console.error(\"Error checking usage:\", error);\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 });\n  }\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,mBAAmB;AAElB,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,qJAAc,EAAC;QAElC,IAAI,CAAC,MAAM;YACT,OAAO,sKAAY,CAAC,IAAI,CAAC;gBAAE,eAAe;YAAM,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,MAAM,aAAa,MAAM,IAAA,wJAAiB,EAAC,KAAK,EAAE;QAClD,MAAM,SAAS,KAAK,YAAY,IAAI,aAAa;QAEjD,OAAO,sKAAY,CAAC,IAAI,CAAC;YACvB,eAAe;YACf,cAAc,KAAK,YAAY;YAC/B;YACA;YACA,cAAc,CAAC,KAAK,YAAY,IAAI,cAAc;YAClD,UAAU,KAAK,QAAQ;YACvB,OAAO,KAAK,KAAK;QACnB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,sKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF","debugId":null}}]
}