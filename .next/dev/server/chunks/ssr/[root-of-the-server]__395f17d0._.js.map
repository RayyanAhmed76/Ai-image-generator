{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/my-flux-saas/components/Nav.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { usePathname, useRouter } from \"next/navigation\";\nimport { LogOut } from \"lucide-react\";\nimport { useState, useRef, useEffect } from \"react\";\n\nconst FREE_TRIES_LIMIT = 2;\n\ntype SubscriptionShape = {\n  status?: string | null;\n  current_period_end?: number | string | null;\n  trial_end?: number | string | null;\n  plan_name?: string | null;\n};\n\nexport default function Nav() {\n  const router = useRouter();\n  const pathname = usePathname();\n\n  const [open, setOpen] = useState(false);\n  const [mobileOpen, setMobileOpen] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement | null>(null);\n  const [username, setUsername] = useState<string>(\"User\");\n  const [userInitial, setUserInitial] = useState<string>(\"U\");\n\n  const [subscription, setSubscription] = useState<SubscriptionShape | null>(\n    null\n  );\n  const [isSubscribed, setIsSubscribed] = useState(false);\n  const [usageCount, setUsageCount] = useState<number>(0);\n  const [subLoading, setSubLoading] = useState(true);\n\n  const mobileNavWidthRem = 11;\n\n  function toDate(value?: number | string | null): Date | null {\n    if (!value) return null;\n    if (typeof value === \"number\") {\n      return value > 1e12 ? new Date(value) : new Date(value * 1000);\n    }\n    const d = new Date(value);\n    return isNaN(d.getTime()) ? null : d;\n  }\n\n  function daysLeft(until?: number | string | null) {\n    const d = toDate(until);\n    if (!d) return null;\n    const now = new Date();\n    const ms = d.getTime() - now.getTime();\n    return Math.ceil(ms / (1000 * 60 * 60 * 24));\n  }\n\n  // Fetch user & subscription info\n  useEffect(() => {\n    const fetchUserInfo = async () => {\n      try {\n        const res = await fetch(\"/api/check-usage\");\n        const data = await res.json();\n\n        if (data?.authenticated && data?.username) {\n          setUsername(data.username);\n          setUserInitial(data.username.charAt(0).toUpperCase());\n        }\n\n        setSubscription(data.subscription || null);\n        setIsSubscribed(!!data.isSubscribed);\n        setUsageCount(data.usageCount ?? 0);\n      } catch (err) {\n        console.error(\"Error fetching user info:\", err);\n        setSubscription(null);\n        setIsSubscribed(false);\n        setUsageCount(0);\n      } finally {\n        setSubLoading(false);\n      }\n    };\n    fetchUserInfo();\n  }, []);\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    function handleDocumentClick(e: MouseEvent) {\n      if (!dropdownRef.current) return;\n      if (!dropdownRef.current.contains(e.target as Node)) {\n        setOpen(false);\n      }\n    }\n    document.addEventListener(\"click\", handleDocumentClick);\n    return () => document.removeEventListener(\"click\", handleDocumentClick);\n  }, []);\n\n  useEffect(() => {\n    setMobileOpen(false);\n  }, [pathname]);\n\n  // Mobile nav styling\n  useEffect(() => {\n    const CLASS = \"mobile-nav-open\";\n    const STYLE_ID = \"mobile-nav-open-style\";\n\n    function addStyle() {\n      if (document.getElementById(STYLE_ID)) return;\n      const style = document.createElement(\"style\");\n      style.id = STYLE_ID;\n      style.innerHTML = `\n        body.${CLASS} #__next > * {\n          margin-left: auto !important;\n          margin-right: auto !important;\n          max-width: calc(100% - ${mobileNavWidthRem}rem) !important;\n        }\n        @media (max-width: 420px) {\n          body.${CLASS} #__next > * {\n            max-width: calc(100% - ${mobileNavWidthRem - 0.5}rem) !important;\n          }\n        }\n      `;\n      document.head.appendChild(style);\n    }\n\n    if (mobileOpen) {\n      document.body.classList.add(CLASS);\n      addStyle();\n    } else {\n      document.body.classList.remove(CLASS);\n    }\n\n    return () => document.body.classList.remove(CLASS);\n  }, [mobileOpen]);\n\n  const handleLogout = async () => {\n    try {\n      await fetch(\"/api/logout\", { method: \"POST\" });\n      window.dispatchEvent(\n        new CustomEvent(\"app:notify\", { detail: { message: \"Logged out\" } })\n      );\n      setTimeout(() => router.push(\"/login\"), 600);\n    } catch {\n      window.dispatchEvent(\n        new CustomEvent(\"app:notify\", { detail: { message: \"Logout failed\" } })\n      );\n    }\n  };\n\n  const mobileClosedTransform = mobileOpen\n    ? \"translate-x-0\"\n    : \"translate-x-full\";\n  const borderResponsive =\n    \"border-l border-purple-700/50 sm:border-r sm:border-l-0\";\n\n  // Render subscription / free prompt row\n  const renderSubscriptionRow = () => {\n    if (subLoading) {\n      return (\n        <div className=\"text-center py-2 text-xs text-purple-200\">\n          Loading subscription…\n        </div>\n      );\n    }\n\n    const s = subscription || { status: \"none\", plan_name: \"Free\" };\n    const freeLeft = Math.max(FREE_TRIES_LIMIT - usageCount, 0);\n\n    // Free prompts\n    if (!isSubscribed && freeLeft > 0) {\n      return (\n        <div className=\"flex flex-col gap-2\">\n          <div className=\"text-sm font-medium text-purple-100\">Free usage</div>\n          <div className=\"text-xs text-purple-200\">\n            {freeLeft} free prompt{freeLeft > 1 ? \"s\" : \"\"} left\n          </div>\n          <div className=\"pt-2\">\n            <button\n              onClick={() => router.push(\"/subscribe\")}\n              className=\"block w-full text-center px-2 py-1 rounded-md bg-gradient-to-r from-sky-500 to-indigo-500 text-white text-sm font-medium\"\n              type=\"button\"\n            >\n              Upgrade\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    // Subscribed\n    if (isSubscribed) {\n      const nextDate = toDate(s.current_period_end);\n      const formatted = nextDate\n        ? new Intl.DateTimeFormat(undefined, {\n            month: \"short\",\n            day: \"numeric\",\n            year: \"numeric\",\n          }).format(nextDate)\n        : \"Next billing available\";\n\n      return (\n        <div className=\"flex flex-col gap-2\">\n          <div className=\"text-sm font-medium text-purple-100\">Subscribed</div>\n          <div className=\"text-xs text-purple-200\">Plan: {s.plan_name}</div>\n          <div className=\"pt-2\">\n            <button\n              onClick={() => router.push(\"/account\")}\n              className=\"block w-full text-center px-2 py-1 cursor-pointer rounded-md border hover:bg-purple-500 border-purple-600 text-purple-100 text-sm font-medium\"\n              type=\"button\"\n            >\n              Manage\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    // Not subscribed and no free prompts\n    return (\n      <div className=\"flex flex-col gap-2\">\n        <div className=\"text-sm font-medium text-purple-100\">\n          Not subscribed\n        </div>\n        <div className=\"text-xs text-purple-200\">\n          Start your subscription for unlimited prompts.\n        </div>\n        <div className=\"pt-2\">\n          <button\n            onClick={() => router.push(\"/subscribe\")}\n            className=\"block w-full text-center px-2 py-1 rounded-md bg-gradient-to-r from-sky-500 to-indigo-500 text-white text-sm font-medium\"\n            type=\"button\"\n          >\n            Subscribe\n          </button>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <>\n      {/* Mobile toggle button */}\n      <button\n        aria-label={mobileOpen ? \"Close navigation\" : \"Open navigation\"}\n        onClick={() => setMobileOpen((s) => !s)}\n        className={`${\n          mobileOpen\n            ? \"\"\n            : \"sm:hidden fixed top-4 right-4 z-50 bg-purple-800/90 text-white p-2 rounded-md shadow-lg focus:outline-none\"\n        }`}\n      >\n        {!mobileOpen && (\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            className=\"h-5 w-5\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n          >\n            <path\n              strokeWidth=\"2\"\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M4 6h16M4 12h16M4 18h16\"\n            />\n          </svg>\n        )}\n      </button>\n\n      {/* Mobile overlay */}\n      <div\n        aria-hidden={!mobileOpen}\n        onClick={() => setMobileOpen(false)}\n        className={`sm:hidden fixed inset-0 bg-black/40 z-30 transition-opacity ${\n          mobileOpen\n            ? \"opacity-100 pointer-events-auto\"\n            : \"opacity-0 pointer-events-none\"\n        }`}\n      />\n\n      {/* Sidebar */}\n      <nav\n        className={`fixed top-0 h-full z-40 flex flex-col py-4 sm:py-6\n          bg-gradient-to-b from-purple-900/90 via-purple-800/90 to-indigo-900/90 backdrop-blur-md\n          transition-transform duration-300 ease-in-out transform\n          ${mobileClosedTransform} sm:translate-x-0\n          right-0 sm:left-0 sm:right-auto\n          w-44 sm:w-16 ${borderResponsive}`}\n        style={{ willChange: \"transform\" }}\n      >\n        {/* Logo */}\n        <div className=\"mb-4 sm:mb-8 w-full flex items-center justify-center sm:justify-center px-3\">\n          <Link href=\"/\" className=\"flex items-center gap-3 w-full\">\n            <div className=\"w-12 h-12 sm:w-16 sm:h-16 rounded-xl p-1.5 sm:p-2 flex items-center justify-center bg-zinc-300 shadow-lg hover:shadow-xl transition-shadow\">\n              <img\n                src=\"/images/logo.png\"\n                alt=\"Logo\"\n                className=\"w-full h-full object-contain rounded-md\"\n              />\n            </div>\n            <span\n              className={`${\n                mobileOpen ? \"inline-block\" : \"hidden\"\n              } sm:hidden text-white font-semibold text-lg ml-2 truncate`}\n            >\n              Bunyad\n            </span>\n          </Link>\n        </div>\n\n        {/* Nav links */}\n        <div className=\"flex flex-col gap-3 w-full px-2\">\n          <Link\n            href=\"/\"\n            className={`flex items-center gap-3 p-2 rounded-lg transition-all w-full ${\n              pathname === \"/\"\n                ? \"bg-purple-600/50 text-white shadow-lg\"\n                : \"text-purple-200 hover:bg-purple-700/30 hover:text-white\"\n            } ${mobileOpen ? \"justify-start pl-3\" : \"justify-center\"}`}\n            title=\"Dashboard\"\n          >\n            <svg\n              className=\"w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"\n              />\n            </svg>\n            <span\n              className={`${\n                mobileOpen ? \"inline-block\" : \"hidden\"\n              } sm:hidden text-sm font-medium`}\n            >\n              Dashboard\n            </span>\n          </Link>\n          <button\n            onClick={() => router.push(\"/subscribe\")}\n            className={`flex items-center gap-3 p-2 cursor-pointer rounded-lg transition-all w-full ${\n              pathname === \"/subscribe\"\n                ? \"bg-purple-600/50 text-white shadow-lg\"\n                : \"text-purple-200 hover:bg-purple-700/30 hover:text-white\"\n            } ${mobileOpen ? \"justify-start pl-3\" : \"justify-center\"}`}\n            title=\"Plans\"\n            type=\"button\"\n          >\n            <svg\n              className=\"w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n              />\n            </svg>\n            <span\n              className={`${\n                mobileOpen ? \"inline-block\" : \"hidden\"\n              } sm:hidden text-sm font-medium`}\n            >\n              Plans\n            </span>\n          </button>\n        </div>\n\n        {/* Logout / avatar */}\n        <div className=\"mt-auto w-full px-2 pb-4\">\n          <div ref={dropdownRef} className=\"relative w-full\">\n            <button\n              onClick={() => setOpen((s) => !s)}\n              aria-haspopup=\"true\"\n              aria-expanded={open}\n              className={`w-full flex items-center gap-2 p-2 rounded-lg transition-all cursor-pointer text-purple-200 hover:bg-purple-700/30 hover:text-white ${\n                mobileOpen ? \"justify-start pl-3\" : \"justify-center\"\n              }`}\n              title={username}\n            >\n              <div className=\"w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center font-semibold text-white text-xs sm:text-sm shadow-lg flex-shrink-0\">\n                {userInitial}\n              </div>\n              <span\n                className={`${\n                  mobileOpen ? \"inline-block\" : \"hidden\"\n                } sm:hidden ml-1 text-sm font-medium`}\n              >\n                {username}\n              </span>\n            </button>\n\n            <div\n              className={`absolute right-full mr-2 bottom-0 w-44 sm:w-48 bg-purple-800/95 backdrop-blur-md border border-purple-600/50 rounded-lg shadow-xl z-50 sm:left-full sm:ml-2 sm:right-auto ${\n                open ? \"block\" : \"hidden\"\n              }`}\n            >\n              <div className=\"p-3\">\n                <div className=\"px-2 py-1.5 text-sm text-purple-100 font-semibold\">\n                  {username}\n                </div>\n                <div className=\"mt-2\">{renderSubscriptionRow()}</div>\n                <div className=\"mt-3 border-t border-purple-700/50 pt-3\">\n                  <button\n                    onClick={handleLogout}\n                    className=\"w-full flex items-center gap-2 px-2 py-2 text-sm text-purple-200 hover:bg-purple-700/50 rounded cursor-pointer transition-colors\"\n                    aria-label=\"Logout\"\n                  >\n                    <LogOut size={16} />\n                    <span>Logout</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </nav>\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 634, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/my-flux-saas/app/account/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport Nav from \"@/components/Nav\"; // adjust path\r\nimport { useRouter } from \"next/navigation\";\r\n\r\ntype Sub = {\r\n  status?: string | null;\r\n  current_period_end?: number | string | null;\r\n  trial_end?: number | string | null;\r\n  plan_name?: string | null;\r\n};\r\n\r\nexport default function AccountPage() {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  const [subLoading, setSubLoading] = useState(false);\r\n  const [data, setData] = useState<any>(null);\r\n  const [err, setErr] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const res = await fetch(\"/api/check-usage\");\r\n        if (!res.ok) throw new Error(\"Failed\");\r\n        const json = await res.json();\r\n        setData(json);\r\n      } catch (e: any) {\r\n        setErr(\"Failed to load account data.\");\r\n        console.error(e);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  function formatDate(val?: number | string | null) {\r\n    if (!val) return \"—\";\r\n    const d = typeof val === \"number\" ? new Date(val * 1000) : new Date(val);\r\n    return d.toLocaleDateString();\r\n  }\r\n\r\n  async function openPortal() {\r\n    setSubLoading(true);\r\n\r\n    \r\n    await new Promise((resolve) => requestAnimationFrame(() => resolve(null)));\r\n\r\n    try {\r\n      const res = await fetch(\"/api/create-portal-session\", { method: \"POST\" });\r\n      const json = await res.json();\r\n      if (json?.url) {\r\n        window.location.href = json.url;\r\n      } else {\r\n        setErr(\"Could not open billing portal.\");\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n      setErr(\"Could not open billing portal.\");\r\n    } finally {\r\n      setSubLoading(false);\r\n    }\r\n  }\r\n\r\n  const sub: Sub | null = data?.subscription ?? null;\r\n  const username = data?.username ?? \"User\";\r\n  const isSubscribed = data?.isSubscribed ?? false;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900\">\r\n      <Nav />\r\n\r\n      \r\n      <main className=\"max-w-3xl mx-auto px-6 lg:pl-28 lg:pr-8 p-6 pt-20 sm:pt-24\">\r\n        <h1 className=\"text-3xl font-bold text-purple-100 mb-2\">Account & Billing</h1>\r\n        <p className=\"text-purple-200 mb-6\">Manage your subscription, payment methods and invoices.</p>\r\n\r\n        {err && (\r\n          <div className=\"mb-4 p-3 rounded-lg bg-red-50 text-red-800 border border-red-200\">\r\n            {err}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"bg-gray-800/40 border border-purple-700/30 rounded-2xl p-6 mb-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <div className=\"text-sm text-purple-200\">User</div>\r\n              <div className=\"text-lg font-semibold text-purple-100\">{username}</div>\r\n            </div>\r\n\r\n            <div className=\"text-right\">\r\n              <div className=\"text-sm text-purple-200\">Status</div>\r\n              <div className=\"text-lg font-semibold text-purple-100\">\r\n                {sub ? (sub.status ?? \"Unknown\") : isSubscribed ? \"Active\" : \"Not subscribed\"}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-6\">\r\n            <div>\r\n              <div className=\"text-xs text-purple-200\">Plan</div>\r\n              <div className=\"text-sm text-purple-100\">{sub?.plan_name ?? (isSubscribed ? \"PRO\" : \"Free\")}</div>\r\n            </div>\r\n            <div>\r\n              <div className=\"text-xs text-purple-200\">Next billing</div>\r\n              <div className=\"text-sm text-purple-100\">{formatDate(sub?.current_period_end)}</div>\r\n            </div>\r\n            <div>\r\n              <div className=\"text-xs text-purple-200\">Trial ends</div>\r\n              <div className=\"text-sm text-purple-100\">{formatDate(sub?.trial_end)}</div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"mt-6 flex gap-3\">\r\n            <button\r\n              onClick={openPortal}\r\n              disabled={subLoading}\r\n              className=\"px-4 py-2 cursor-pointer rounded-xl bg-gradient-to-r from-sky-500 to-indigo-500 text-white font-semibold hover:brightness-105 disabled:opacity-50\"\r\n            >\r\n              {subLoading ? \"Opening portal…\" : \"Manage subscription\"}\r\n            </button>\r\n\r\n            <button\r\n              onClick={() => router.push(\"/subscribe\")}\r\n              className=\"px-4 py-2 cursor-pointer rounded-xl border border-purple-600 text-purple-100 hover:bg-purple-700/20\"\r\n            >\r\n              View plans\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n\r\n        <div className=\"bg-gray-800/30 border border-purple-700/20 rounded-2xl p-6\">\r\n          <h3 className=\"text-lg font-semibold text-purple-100 mb-3\">Invoices & Payments</h3>\r\n          <p className=\"text-sm text-purple-200\">You can view your invoices and payment history in the Stripe Customer Portal.</p>\r\n        </div>\r\n      </main>\r\n\r\n\r\n      {loading && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm pointer-events-none\">\r\n          <div className=\"pointer-events-auto bg-white/6 rounded-lg p-6 flex items-center gap-4\">\r\n            <div className=\"flex items-center space-x-2\">\r\n              <div className=\"w-3 h-3 bg-blue-400 rounded-full animate-bounce\" />\r\n              <div className=\"w-3 h-3 bg-blue-400 rounded-full animate-bounce\" style={{ animationDelay: \"0.15s\" }} />\r\n              <div className=\"w-3 h-3 bg-blue-400 rounded-full animate-bounce\" style={{ animationDelay: \"0.3s\" }} />\r\n            </div>\r\n            <div className=\"text-white\">Loading account…</div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      \r\n      {subLoading && (\r\n        <div className=\"fixed inset-0 z-60 flex items-center justify-center bg-black/60\">\r\n          <div className=\"flex flex-col items-center\">\r\n            <div className=\"w-12 h-12 border-4 border-gray-300 border-t-blue-400 rounded-full animate-spin mb-4\" />\r\n            <div className=\"text-white\">Opening billing portal…</div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}