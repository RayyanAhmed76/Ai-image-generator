{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/my-flux-saas/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient();\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n\nexport default prisma;\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD","debugId":null}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/my-flux-saas/lib/auth.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\r\nimport { prisma } from \"./prisma\";\r\n\r\nexport async function getCurrentUser(req: NextRequest) {\r\n  const token = req.cookies.get(\"flux_auth\")?.value;\r\n  \r\n  if (!token) {\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    // Find token in database\r\n    const tokenRecord = await prisma.token.findUnique({\r\n      where: { token },\r\n      include: { user: true },\r\n    });\r\n\r\n    if (!tokenRecord) {\r\n      return null;\r\n    }\r\n\r\n    // Check if token is expired\r\n    if (new Date() > tokenRecord.expiresAt) {\r\n      // Delete expired token\r\n      await prisma.token.delete({ where: { id: tokenRecord.id } });\r\n      return null;\r\n    }\r\n\r\n    return tokenRecord.user;\r\n  } catch (error) {\r\n    console.error(\"Error getting current user:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function getUserUsageCount(userId: string): Promise<number> {\r\n  try {\r\n    const count = await prisma.usage.count({\r\n      where: { userId },\r\n    });\r\n    return count;\r\n  } catch (error) {\r\n    console.error(\"Error getting usage count:\", error);\r\n    return 0;\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;AACA;;AAEO,eAAe,eAAe,GAAgB;IACnD,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc;IAE5C,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,IAAI;QACF,yBAAyB;QACzB,MAAM,cAAc,MAAM,yHAAM,CAAC,KAAK,CAAC,UAAU,CAAC;YAChD,OAAO;gBAAE;YAAM;YACf,SAAS;gBAAE,MAAM;YAAK;QACxB;QAEA,IAAI,CAAC,aAAa;YAChB,OAAO;QACT;QAEA,4BAA4B;QAC5B,IAAI,IAAI,SAAS,YAAY,SAAS,EAAE;YACtC,uBAAuB;YACvB,MAAM,yHAAM,CAAC,KAAK,CAAC,MAAM,CAAC;gBAAE,OAAO;oBAAE,IAAI,YAAY,EAAE;gBAAC;YAAE;YAC1D,OAAO;QACT;QAEA,OAAO,YAAY,IAAI;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;IACT;AACF;AAEO,eAAe,kBAAkB,MAAc;IACpD,IAAI;QACF,MAAM,QAAQ,MAAM,yHAAM,CAAC,KAAK,CAAC,KAAK,CAAC;YACrC,OAAO;gBAAE;YAAO;QAClB;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DELL/Desktop/my-flux-saas/app/api/checkout/route.ts"],"sourcesContent":["// app/api/checkout/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport Stripe from \"stripe\";\nimport { getCurrentUser } from \"../../../lib/auth\";\n\nexport async function POST(req: NextRequest) {\n  const stripeSecret = process.env.STRIPE_SECRET_KEY;\n  if (!stripeSecret) {\n    return NextResponse.json({ error: \"Stripe key not configured\" }, { status: 500 });\n  }\n\n  // Check authentication\n  const user = await getCurrentUser(req);\n  if (!user) {\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n\n  const stripe = new Stripe(stripeSecret);\n\n  try {\n    const body = await req.json();\n    const priceId = (body?.priceId as string) || process.env.STRIPE_PRICE_ID;\n    if (!priceId) {\n      return NextResponse.json({ error: \"priceId is required\" }, { status: 400 });\n    }\n\n    const session = await stripe.checkout.sessions.create({\n      payment_method_types: [\"card\"],\n      mode: \"subscription\",\n      line_items: [{ price: priceId, quantity: 1 }],\n      metadata: { userId: user.id },\n      customer_email: user.email,\n      success_url: `${process.env.NEXT_PUBLIC_BASE_URL || \"http://localhost:3000\"}/subscribe?success=true&session_id={CHECKOUT_SESSION_ID}`,\n      cancel_url: `${process.env.NEXT_PUBLIC_BASE_URL || \"http://localhost:3000\"}/subscribe?canceled=true`,\n    });\n\n    return NextResponse.json({ url: session.url });\n  } catch (err: any) {\n    console.error(\"checkout error:\", err);\n    return NextResponse.json({ error: err?.message ?? \"unknown error\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"AAAA,4BAA4B;;;;;AAC5B;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAgB;IACzC,MAAM,eAAe,QAAQ,GAAG,CAAC,iBAAiB;IAClD,IAAI,CAAC,cAAc;QACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACjF;IAEA,uBAAuB;IACvB,MAAM,OAAO,MAAM,IAAA,+HAAc,EAAC;IAClC,IAAI,CAAC,MAAM;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IAEA,MAAM,SAAS,IAAI,mKAAM,CAAC;IAE1B,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,UAAU,AAAC,MAAM,WAAsB,QAAQ,GAAG,CAAC,eAAe;QACxE,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,UAAU,MAAM,OAAO,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YACpD,sBAAsB;gBAAC;aAAO;YAC9B,MAAM;YACN,YAAY;gBAAC;oBAAE,OAAO;oBAAS,UAAU;gBAAE;aAAE;YAC7C,UAAU;gBAAE,QAAQ,KAAK,EAAE;YAAC;YAC5B,gBAAgB,KAAK,KAAK;YAC1B,aAAa,GAAG,QAAQ,GAAG,CAAC,oBAAoB,IAAI,wBAAwB,wDAAwD,CAAC;YACrI,YAAY,GAAG,QAAQ,GAAG,CAAC,oBAAoB,IAAI,wBAAwB,wBAAwB,CAAC;QACtG;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,KAAK,QAAQ,GAAG;QAAC;IAC9C,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,KAAK,WAAW;QAAgB,GAAG;YAAE,QAAQ;QAAI;IACrF;AACF","debugId":null}}]
}